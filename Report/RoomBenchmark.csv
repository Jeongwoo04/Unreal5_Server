========== RoomId : 1 Server 초기 상태 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,초기 상태.,
RemoveList,100,12.8773,10.047,30.981,10.087,30.981,3.21718,,async job안에서 sync로 연결된 연쇄 작업.,
Monster,100,83.1358,0.008,320.276,0.009,320.276,94.3914,,worker가 io + gamelogic을 혼합 처리. Session에 packethandler 핸드셰이크 작업을 던질때 fast-path 때문에 딸려 들어감.,
Room,100,926.513,12.573,2276.16,13.898,2276.16,639.097,,sqrt 연산 남발 및 early exit 없음.,
Projectile,100,69.921,0.002,215.954,0.002,215.954,50.4864,,broadcast All,
SkillSystem,100,64.1919,0.006,246.723,0.007,246.723,65.0292,,aoe스킬의 dot피해가 매 틱마다 매 aoe스킬 마다 타격 마다 broadcast 중임. Multiroom으로 돌렸더니 컴 뻗었음,
Field,100,696.302,0.001,1731.55,0.001,1731.55,515.66,,매번 Object 인덱싱에 전체 탐색 -> 거리 체크 (sqrt 남발),
======================================,,,,,,,,,서버는 판정 (GameLogic) 후 알림 (IO Broadcast) 역할을 지연없이 처리해야된다.,
========== RoomId : 1 Server 초기 상태 BENCHMARK SUMMARY ==========,,,,,,,,,GameLogic과 IO 를 분리후 병렬 처리를 해야한다.,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,Broadcast Queue를 Room별 배치하고 Room의 JobQueue로 GameLogic이 직렬로 실행되면서 판정을 알릴때 BroadcastQueue에 작업을 던져서 병렬로 실행되도록 하자.,
RemoveList,100,11.3846,8.159,15.427,8.941,15.427,1.3747,,,
Monster,100,150.884,43.505,301.101,45.012,301.101,85.129,,,
Room,100,2248.13,1511.66,2844.11,1512.99,2844.11,275.029,,,
Projectile,100,106.08,34.967,229.269,45.381,229.269,41.5533,,,
SkillSystem,100,120.384,17.572,246.03,24.223,246.03,65.0382,,,
Field,100,1859.3,1222.16,2548.35,1250.75,2548.35,252.53,,,
======================================,,,,,,,,,,
========== RoomId : 1 ChangeHP Packet Batch BENCHMARK SUMMARY ==========,,,,,,,,,,aoe스킬의 dot피해가 매 틱마다 매 aoe스킬 마다 타격 마다 broadcast 중임. Multiroom으로 돌렸더니 컴 뻗었음
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,> Packet Batch로 field의 범위 안 targets에 대한 판정을 모아서 보내기.
RemoveList,100,12.9197,10.273,26.88,10.37,26.88,2.07203,,,
Monster,100,20.9557,0.007,296.751,0.007,296.751,50.9829,,,
Room,100,107.758,14.198,362.748,16.118,362.748,62.2571,,,
Projectile,100,27.6428,0.002,87.585,0.003,87.585,23.6064,,,
SkillSystem,100,11.2728,0.006,103.025,0.006,103.025,19.4501,,,
Field,100,34.8839,0.001,99.679,0.002,99.679,29.5594,,,
======================================,,,,,,,,,,
========== RoomId : 1 ChangeHP Packet Batch BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,13.8932,10.408,24.165,10.87,24.165,2.85418,,,
Monster,100,19.8535,0.007,283.885,0.008,283.885,54.8756,,,
Room,100,100.919,12.309,403.469,12.688,403.469,65.2319,,,
Projectile,100,24.3018,0.002,91.563,0.003,91.563,23.1036,,,
SkillSystem,100,11.114,0.004,113.527,0.005,113.527,20.2638,,,
Field,100,31.6692,0.002,100.978,0.002,100.978,27.5277,,,
======================================,,,,,,,,,,
========== RoomId : 1 SpatialHash활용. 연산 최적화 sqrt 제거 및 중복연산 제거. field 범위 grid 캐싱 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,O(1) 인덱싱을 위한 SpatialHash 구조로 변경. 쿼드트리보단 지속적인 움직임이 있어 일정한 크기로 나뉜 Grid를 사용하기 위함.
RemoveList,100,13.2134,10.52,24.95,10.532,24.95,2.2418,,,쿼드트리로 사용해서는 잦은 트리구조조정이 생김
Monster,100,21.163,0.005,306.996,0.007,306.996,56.6736,,,"인덱싱 최적화에 필요한 캐싱 , 탐색 연산의 최적화. Sqrt 계산 최소화. 중복연산 제거 및 early exit"
Room,100,119.066,13.686,371.531,14.404,371.531,65.1221,,,
Projectile,100,42.517,0.002,115.116,0.002,115.116,28.5526,,,
SkillSystem,100,11.5122,0.006,98.069,0.006,98.069,20.933,,,
Field,100,30.5757,0.001,76.572,0.002,76.572,20.9597,,,
======================================,,,,,,,,,,
========== RoomId : 1 SpatialHash활용. 연산 최적화 sqrt 제거 및 중복연산 제거. field 범위 grid 캐싱 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,12.9242,11.463,16.939,11.508,16.939,1.07129,,,
Monster,100,18.4263,0.009,74.844,0.009,74.844,20.2959,,,
Room,100,62.9445,12.508,161.77,13.594,161.77,32.0107,,,
Projectile,100,16.2118,0.000999999,56.3,0.002,56.3,15.2297,,,
SkillSystem,100,7.4488,0.003,59.464,0.003,59.464,13.0258,,,
Field,100,7.84652,0.001,32.829,0.001,32.829,9.03138,,,
======================================,,,,,,,,,,
========== RoomId : 1 Monster 로직 버그 수정. RayCasting Loop 최대 250배 감소. Monster AI 로직 분산 처리. BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,monster 로직 버그 수정 및 RayCasting 간격 조정. 기존 대비 Loop 최대 250배 감소
RemoveList,100,14.148,10.923,25.834,11.231,25.834,3.21559,,,"monster Update시 모든 monster의 동일 AI 로직이 같이 일어남. AI 틱을 분산. (search , cooldown 등등)"
Monster,100,9.40216,0.008,225.389,0.008,225.389,28.2036,,,
Room,100,79.9714,13.172,238.78,13.197,238.78,42.5867,,,
Projectile,100,19.1034,0.001,106.14,0.001,106.14,21.3463,,,
SkillSystem,100,11.1845,0.006,151.976,0.007,151.976,24.6892,,,
Field,100,26.0493,0.001,70.915,0.001,70.915,17.0369,,,
======================================,,,,,,,,,,
========== RoomId : 1 Monster 로직 버그 수정. RayCasting Loop 최대 250배 감소. Monster AI 로직 분산 처리. BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,15.7786,11.455,23.292,12.287,23.292,3.61971,,,
Monster,100,9.46486,0.008,52.391,0.008,52.391,12.0328,,,
Room,100,56.7356,19.572,133.314,19.584,133.314,25.5575,,,
Projectile,100,12.6671,0.001,68.458,0.001,68.458,14.9277,,,
SkillSystem,100,7.91921,0.002,75.815,0.003,75.815,14.8492,,,
Field,100,10.8223,0.001,39.781,0.001,39.781,10.4183,,,
======================================,,,,,,,,,,
========== RoomId : 1 GameLogic Job에서 실행되는 IO Broadcast 를 Async Job으로 Room JobQueue 뒤에 등록 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,GameLogic에서 서버는 판정을 지연없이 처리를 해서 유저에게 알려줘야하는데 RoomTick이 판정보다 알림(Broadcast)쪽이 더 오래걸림
RemoveList,100,20.4296,17.841,26.905,17.891,26.905,1.85349,,,알림을 AsyncJob으로 Update 이후로 등록
Monster,100,3.41653,0.007,78.388,0.008,78.388,10.2898,,,
Room,100,36.2933,20.356,128.081,20.521,128.081,16.8773,,,
Projectile,100,6.30173,0.001,37.113,0.001,37.113,6.45099,,,
SkillSystem,100,5.92273,0.003,104.364,0.003,104.364,15.3074,,,
Field,100,0.12999,0.000999999,0.45,0.002,0.45,0.130358,,,
======================================,,,,,,,,,,
========== RoomId : 1 GameLogic Job에서 실행되는 IO Broadcast 를 Async Job으로 Room JobQueue 뒤에 등록 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,19.7026,17.836,27.636,17.861,27.636,1.68265,,,
Monster,100,2.87803,0.008,24.196,0.008,24.196,3.5876,,,
Room,100,30.6673,18.062,68.341,18.201,68.341,10.2975,,,
Projectile,100,3.71253,0.001,19.434,0.002,19.434,4.68457,,,
SkillSystem,100,4.13486,0.003,40.09,0.003,40.09,8.92522,,,
Field,100,0.12393,0.001,0.531,0.001,0.531,0.104015,,,
======================================,,,,,,,,,,
========== RoomId : 1 SkillSystem의 Spawn을 Async Job처리 -> Sync로 일어나는 연쇄작업 분산 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,SkillSystem 내의 로직 판정 후 연쇄적으로 타고들어가서 Sync한 작업이 일어남.
RemoveList,100,20.104,17.833,25.399,18.129,25.399,1.62758,,,해당 작업들을 분산 처리. Spawn이라는 Action이 실행되어야함 -> Async로 등록. 실행중인 Update 이후 처리
Monster,100,3.13302,0.008,74.864,0.008,74.864,9.90071,,,체감 지연시간 최대 1Tick
Room,100,32.705,18.636,93.768,19.078,93.768,10.5592,,,
Projectile,100,9.18138,0.002,39.108,0.002,39.108,6.84424,,,
SkillSystem,100,0.0199,0.003,0.186,0.003,0.186,0.0231687,,,
Field,100,0.18188,0.001,0.711,0.001,0.711,0.122774,,,
======================================,,,,,,,,,,
========== RoomId : 1 SkillSystem의 Spawn을 Async Job처리 -> Sync로 일어나는 연쇄작업 분산 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,19.8938,17.974,26.09,18.083,26.09,1.4567,,,
Monster,100,3.74881,0.01,15.183,0.011,15.183,3.80811,,,
Room,100,28.1517,18.477,49.686,18.616,49.686,6.29599,,,
Projectile,100,4.3333,0.002,19.797,0.002,19.797,4.60681,,,
SkillSystem,100,0.01791,0.002,0.065,0.003,0.065,0.0154137,,,
Field,100,0.06653,0.000999999,0.433,0.000999999,0.433,0.100789,,,
======================================,,,,,,,,,,
========== RoomId : 1 Room별 Broadcast Queue 배치 → Broadcast와 Room Logic 완전 분리 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,알림 Job을 Update 뒤로 Async했는데. Worker는 Room의 Update에 Timer로 100ms 이후 예약을 함.
RemoveList,100,0.22199,0.176,1.097,0.181,1.097,0.0961525,,,이후 쌓인 Async Job을 처리하고 Update가 돌아오는데 까지 걸리는 Room Tick Interval이 100ms를 초과함
Monster,100,0.54363,0.008,9.553,0.009,9.553,1.40362,,,Room마다 Broadcast Queue(JobQueue)를 배치 -> Room에서의 판정 -> 곧바로 BCQueue에 Push -> 여유있는 Worker가 바로 꺼내서 실행하도록
Room,100,3.63598,0.332,10.707,0.334,10.707,1.97446,,,Room Logic과 Room Broadcast의 완벽한 병렬 처리.
Projectile,100,1.09354,0.001,5.37,0.002,5.37,1.18639,,,Room Interval 100ms 내에 BroadcastQueue에 쌓인 일감이 전부 소진됨.
SkillSystem,100,0.23986,0.002,2.151,0.002,2.151,0.435707,,,지연 없음
Field,100,1.44619,0.000999998,3.442,0.001,3.442,1.21065,,,
======================================,,,,,,,,,,
========== RoomId : 1 Room별 Broadcast Queue 배치 → Broadcast와 Room Logic 완전 분리 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,0.2264,0.188,0.562,0.191,0.562,0.0529129,,,
Monster,100,0.50183,0.009,2.367,0.01,2.367,0.626306,,,
Room,100,2.4828,0.271,8.104,0.336,8.104,1.30315,,,
Projectile,100,0.64643,0.001,3.749,0.002,3.749,0.888965,,,
SkillSystem,100,0.24713,0.002,2.458,0.003,2.458,0.445347,,,
Field,100,0.72692,0.001,2.808,0.001,2.808,0.601393,,,
======================================,,,,,,,,,,
========== RoomId : 1 IO Worker / Game Worker 분리. DoAsyncPushOnly -> IOWorker와 MainThread 의 fast-path 방지 + MultiRoom 테스트 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,IO Worker가 Kernel의 IOCP 큐에서 완료통지를 받아 Session의 OnRecv를 통해 PacketHandler진입 -> Room과의 핸드셰이크.
RemoveList,100,0.29571,0.227,0.487,0.229,0.487,0.0524923,,,기존 DoWorker에선 Dispatch + DoGlobalWork였고. JobQueue의 Push는 처음 Job을 밀어넣고. 해당 Thread가 작업중인 JobQueue가 없으면 fast-path로 실행까지 담당.
Monster,100,0.64383,0.007,15.206,0.008,15.206,1.8816,,,여기서 Job이 길어질경우 점유시간이 길어질 수 있음.
Room,100,4.46475,0.326,15.646,0.338,15.646,2.44644,,,역할분리를 명확히 하고 IO Worker는 IOCP 이벤트를 책임져 Session의 OnRecv를 통한 Room과의 핸드셰이크 -> Async Job을 해당 Room에 PushOnly 만
Projectile,100,0.974,0.000999998,5.708,0.000999998,5.708,1.39202,,,MainThread가 RoomManager를 통해 Init을 하게 되면 Push를 통해 Execute로 진입 -> PushOnly로 Push만 하고 나오기
SkillSystem,100,0.35616,0.003,3.443,0.004,3.443,0.688627,,,
Field,100,2.1212,0.001,5.923,0.002,5.923,1.31067,,,
======================================,,,,,,,,,,
========== RoomId : 2 IO Worker / Game Worker 분리. DoAsyncPushOnly -> IOWorker와 MainThread 의 fast-path 방지 + MultiRoom 테스트 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,0.30641,0.235,0.583,0.236,0.583,0.0548721,,,
Monster,100,0.70318,0.008,12.39,0.009,12.39,1.73794,,,
Room,100,6.01427,0.328,12.894,0.375,12.894,2.2875,,,
Projectile,100,2.34976,0.001,6.081,0.002,6.081,1.55579,,,
SkillSystem,100,0.35978,0.004,4.879,0.004,4.879,0.788123,,,
Field,100,2.22072,0.000999998,4.066,0.001,4.066,1.22758,,,
======================================,,,,,,,,,,
========== RoomId : 1 IO Worker / Game Worker 분리. DoAsyncPushOnly -> IOWorker와 MainThread 의 fast-path 방지 + MultiRoom 테스트 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,0.31306,0.236,0.499,0.239,0.499,0.0637416,,,
Monster,100,0.50572,0.009,2.703,0.01,2.703,0.689414,,,
Room,100,2.8141,0.307,8.949,0.318,8.949,1.8875,,,
Projectile,100,0.54788,0.001,4.484,0.001,4.484,1.07386,,,
SkillSystem,100,0.32668,0.003,2.236,0.003,2.236,0.554347,,,
Field,100,1.03062,0.001,5.827,0.001,5.827,1.24267,,,
======================================,,,,,,,,,,
========== RoomId : 2 IO Worker / Game Worker 분리. DoAsyncPushOnly -> IOWorker와 MainThread 의 fast-path 방지 + MultiRoom 테스트 BENCHMARK SUMMARY ==========,,,,,,,,,,
Name,Samples,Avg,Min,Max,p01,p99,StdDev,,,
RemoveList,100,0.31868,0.232,0.519,0.239,0.519,0.0582712,,,
Monster,100,1.17613,0.01,5.211,0.011,5.211,1.11778,,,
Room,100,3.54728,0.318,11,0.346,11,2.43418,,,
Projectile,100,1.07592,0.002,7.049,0.002,7.049,1.32141,,,
SkillSystem,100,0.26913,0.002,2.311,0.002,2.311,0.502072,,,
Field,100,0.62877,0.000999998,3.488,0.001,3.488,0.977927,,,
======================================,,,,,,,,,,
